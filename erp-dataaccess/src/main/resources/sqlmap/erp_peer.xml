<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxzl.erp.dataaccess.dao.mysql.peer.PeerMapper">

	<resultMap id="PeerDO" type="com.lxzl.erp.dataaccess.domain.peer.PeerDO">
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="peer_no" jdbcType="VARCHAR" property="peerNo" />
		<result column="peer_name" jdbcType="VARCHAR" property="peerName" />
		<result column="peer_code" jdbcType="VARCHAR" property="peerCode" />
		<result column="province" jdbcType="INTEGER" property="province" />
		<result column="city" jdbcType="INTEGER" property="city" />
		<result column="district" jdbcType="INTEGER" property="district" />
		<result column="address" jdbcType="VARCHAR" property="address" />
		<result column="tel" jdbcType="VARCHAR" property="tel" />
		<result column="contact_name" jdbcType="VARCHAR" property="contactName" />
		<result column="contact_phone" jdbcType="VARCHAR" property="contactPhone" />
		<result column="beneficiary_name" jdbcType="VARCHAR" property="beneficiaryName" />
		<result column="beneficiary_account" jdbcType="VARCHAR" property="beneficiaryAccount" />
		<result column="beneficiary_bank_name" jdbcType="VARCHAR" property="beneficiaryBankName" />
		<result column="data_status" jdbcType="INTEGER" property="dataStatus" />
		<result column="remark" jdbcType="VARCHAR" property="remark" />
		<result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
		<result column="create_user" jdbcType="VARCHAR" property="createUser" />
		<result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
		<result column="update_user" jdbcType="VARCHAR" property="updateUser" />
		<collection property="areaCityDO" resultMap="AreaCityDO" />
		<collection property="areaDistrictDO" resultMap="AreaDistrictDO" />
		<collection property="areaProvinceDO" resultMap="AreaProvinceDO" />
	</resultMap>

	<resultMap id="AreaCityDO" type="com.lxzl.erp.dataaccess.domain.area.AreaCityDO">
		<id column="eac_id" jdbcType="INTEGER" property="id" />
		<result column="eac_provinceId" jdbcType="INTEGER" property="provinceId" />
		<result column="eac_cityName" jdbcType="VARCHAR" property="cityName" />
		<result column="eac_cityCode" jdbcType="VARCHAR" property="cityCode" />
		<result column="eac_postCode" jdbcType="VARCHAR" property="postCode" />
		<result column="eac_abbCn" jdbcType="VARCHAR" property="abbCn" />
		<result column="eac_abbEn" jdbcType="VARCHAR" property="abbEn" />
		<result column="eac_dataStatus" jdbcType="INTEGER" property="dataStatus" />
		<result column="eac_remark" jdbcType="VARCHAR" property="remark" />
	</resultMap>

	<resultMap id="AreaDistrictDO" type="com.lxzl.erp.dataaccess.domain.area.AreaDistrictDO">
		<id column="ead_id" jdbcType="INTEGER" property="id" />
		<result column="ead_provinceId" jdbcType="INTEGER" property="provinceId" />
		<result column="ead_cityId" jdbcType="INTEGER" property="cityId" />
		<result column="ead_districtName" jdbcType="VARCHAR" property="districtName" />
		<result column="ead_postCode" jdbcType="VARCHAR" property="postCode" />
		<result column="ead_abbCn" jdbcType="VARCHAR" property="abbCn" />
		<result column="ead_abbEn" jdbcType="VARCHAR" property="abbEn" />
		<result column="ead_dataStatus" jdbcType="INTEGER" property="dataStatus" />
		<result column="ead_remark" jdbcType="VARCHAR" property="remark" />
	</resultMap>
	<resultMap id="AreaProvinceDO" type="com.lxzl.erp.dataaccess.domain.area.AreaProvinceDO">
		<id column="eap_id" jdbcType="INTEGER" property="id" />
		<result column="eap_provinceName" jdbcType="VARCHAR" property="provinceName" />
		<result column="eap_areaType" jdbcType="INTEGER" property="areaType" />
		<result column="eap_abbCn" jdbcType="VARCHAR" property="abbCn" />
		<result column="eap_abbEn" jdbcType="VARCHAR" property="abbEn" />
		<result column="eap_dataStatus" jdbcType="INTEGER" property="dataStatus" />
		<result column="eap_remark" jdbcType="VARCHAR" property="remark" />
	</resultMap>

	<sql id="province_column_List">
		eap.id AS eap_id,eap.province_name AS eap_provinceName,eap.area_type AS eap_areaType,eap.abb_cn AS eap_abbCn,eap.abb_en AS eap_abbEn,eap.data_status AS eap_dataStatus,eap.remark AS eap_remark
	</sql>
	<sql id="district_column_List">
		ead.id AS ead_id,ead.province_id AS ead_provinceId,ead.city_id AS ead_cityId,ead.district_name AS ead_districtName,ead.post_code AS ead_postCode,ead.abb_cn AS ead_abbCn,ead.abb_en AS ead_abbEn,ead.data_status AS ead_dataStatus,ead.remark AS ead_remark
	</sql>
	<sql id="city_column_List">
		eac.id AS eac_id,eac.province_id AS eac_provinceId,eac.city_name AS eac_cityName,eac.city_code AS eac_cityCode,eac.post_code AS eac_postCode,eac.abb_cn AS eac_abbCn,eac.abb_en AS eac_abbEn,eac.data_status AS eac_dataStatus,eac.remark AS eac_remark
	</sql>
	<sql id="column_List">
		ep.id,ep.peer_no,ep.peer_name,ep.peer_code,ep.province,ep.city,ep.district,ep.address,ep.tel,ep.contact_name,ep.contact_phone,ep.beneficiary_name,ep.beneficiary_account,ep.beneficiary_bank_name,ep.data_status,ep.remark,ep.create_time,ep.create_user,ep.update_time,ep.update_user
	</sql>

	<select id="findById" resultMap="PeerDO" parameterType="java.lang.Integer">
		SELECT <include refid="column_List"/> FROM erp_peer ep
		WHERE ep.id = #{id, jdbcType=INTEGER} AND ep.data_status = 1
	</select>

	<select id="listCount" resultType="java.lang.Integer" parameterType="map">
		SELECT count(ep.id) FROM erp_peer ep
		<where>
			<if test="maps.queryParam != null &amp;&amp; maps.queryParam.peerName != null &amp;&amp; maps.queryParam.peerName != ''">
				and ep.peer_name = #{maps.queryParam.peerName,jdbcType=VARCHAR}
			</if>
			<if test="maps.queryParam != null &amp;&amp; maps.queryParam.peerCode != null &amp;&amp; maps.queryParam.peerCode != ''">
				and ep.peer_code = #{maps.queryParam.peerCode,jdbcType=VARCHAR}
			</if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.provinceId != null &amp;&amp; maps.queryParam.provinceId != ''">
                and ep.province = #{maps.queryParam.provinceId,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.cityId != null &amp;&amp; maps.queryParam.cityId != ''">
                and ep.city = #{maps.queryParam.cityId,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.districtId != null &amp;&amp; maps.queryParam.districtId != ''">
                and ep.district = #{maps.queryParam.districtId,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam.createStartTime != null &amp;&amp; maps.queryParam.createStartTime != ''">
                <![CDATA[ AND ejp.create_time >= #{maps.queryParam.createStartTime} ]]>
            </if>
            <if test="maps.queryParam.createEndTime != null &amp;&amp; maps.queryParam.createEndTime != ''">
                <![CDATA[ AND ejp.create_time <= #{maps.queryParam.createEndTime} ]]>
            </if>
			<if test="true">
				AND ep.data_status = 1
			</if>
		</where>
	</select>

	<select id="listPage" resultMap="PeerDO" parameterType="map">
		SELECT <include refid="column_List"/> ,<include refid="province_column_List"/>,<include refid="district_column_List"/>,<include refid="city_column_List"/>
        FROM erp_peer ep
        LEFT JOIN erp_area_city eac ON ep.city = eac.id AND eac.data_status = 1
        LEFT JOIN erp_area_district ead ON ep.city = ead.id AND ead.data_status = 1
        LEFT JOIN erp_area_province eap ON ep.city = eap.id AND eap.data_status = 1
		<where>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.peerName != null &amp;&amp; maps.queryParam.peerName != ''">
                and ep.peer_name = #{maps.queryParam.peerName,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.peerCode != null &amp;&amp; maps.queryParam.peerCode != ''">
                and ep.peer_code = #{maps.queryParam.peerCode,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.provinceId != null &amp;&amp; maps.queryParam.provinceId != ''">
                and ep.province = #{maps.queryParam.provinceId,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.peerNo != null &amp;&amp; maps.queryParam.peerNo != ''">
                and ep.peer_no = #{maps.queryParam.peerNo,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.cityId != null &amp;&amp; maps.queryParam.cityId != ''">
                and ep.city = #{maps.queryParam.cityId,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam != null &amp;&amp; maps.queryParam.districtId != null &amp;&amp; maps.queryParam.districtId != ''">
                and ep.district = #{maps.queryParam.districtId,jdbcType=VARCHAR}
            </if>
            <if test="maps.queryParam.createStartTime != null &amp;&amp; maps.queryParam.createStartTime != ''">
                <![CDATA[ AND ejp.create_time >= #{maps.queryParam.createStartTime} ]]>
            </if>
            <if test="maps.queryParam.createEndTime != null &amp;&amp; maps.queryParam.createEndTime != ''">
                <![CDATA[ AND ejp.create_time <= #{maps.queryParam.createEndTime} ]]>
            </if>
			<if test="true">
				AND ep.data_status = 1
			</if>
		</where>
        ORDER BY ep.create_time DESC
		LIMIT #{maps.start},#{maps.pageSize}
	</select>

	<sql id="set_column_sql">
		<set>
			<if test="peerNo != null">
				peer_no = #{peerNo,jdbcType=VARCHAR},
			</if>
			<if test="peerName != null">
				peer_name = #{peerName,jdbcType=VARCHAR},
			</if>
			<if test="peerCode != null">
				peer_code = #{peerCode,jdbcType=VARCHAR},
			</if>
			<if test="province != null">
				province = #{province,jdbcType=INTEGER},
			</if>
			<if test="city != null">
				city = #{city,jdbcType=INTEGER},
			</if>
			<if test="district != null">
				district = #{district,jdbcType=INTEGER},
			</if>
			<if test="address != null">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="tel != null">
				tel = #{tel,jdbcType=VARCHAR},
			</if>
			<if test="contactName != null">
				contact_name = #{contactName,jdbcType=VARCHAR},
			</if>
			<if test="contactPhone != null">
				contact_phone = #{contactPhone,jdbcType=VARCHAR},
			</if>
			<if test="beneficiaryName != null">
				beneficiary_name = #{beneficiaryName,jdbcType=VARCHAR},
			</if>
			<if test="beneficiaryAccount != null">
				beneficiary_account = #{beneficiaryAccount,jdbcType=VARCHAR},
			</if>
			<if test="beneficiaryBankName != null">
				beneficiary_bank_name = #{beneficiaryBankName,jdbcType=VARCHAR},
			</if>
			<if test="dataStatus != null">
				data_status = #{dataStatus,jdbcType=INTEGER},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="createUser != null">
				create_user = #{createUser,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateUser != null">
				update_user = #{updateUser,jdbcType=VARCHAR},
			</if>
		</set>
	</sql>

	<insert id="save" keyProperty="id" useGeneratedKeys="true" parameterType="com.lxzl.erp.dataaccess.domain.peer.PeerDO">
		INSERT INTO erp_peer <include refid="set_column_sql"/>
	</insert>

	<update id="update" parameterType="com.lxzl.erp.dataaccess.domain.peer.PeerDO">
		UPDATE erp_peer <include refid="set_column_sql"/> WHERE id = #{id, jdbcType=INTEGER}
	</update>

	<select id="findDetailByPeerId" resultMap="PeerDO" parameterType="java.lang.Integer">
		SELECT <include refid="column_List"/>,<include refid="province_column_List"/>,<include refid="district_column_List"/>,<include refid="city_column_List"/>
            FROM erp_peer ep
            LEFT JOIN erp_area_city eac ON ep.city = eac.id AND eac.data_status = 1
            LEFT JOIN erp_area_district ead ON ep.city = ead.id AND ead.data_status = 1
            LEFT JOIN erp_area_province eap ON ep.city = eap.id AND eap.data_status = 1
                <where>
                    <if test="peerId != null">
                        AND ep.id = ${peerId}
                    </if>
                    <if test="true">
                        AND ep.data_status = 1
                    </if>
                </where>
            ORDER BY ep.create_time DESC
	</select>

</mapper>